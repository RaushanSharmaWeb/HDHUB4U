<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - HDHub4u</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- CSS STYLES --- */
        :root {
            --primary: #e50914;
            --dark: #141414;
            --light: #f5f5f5;
            --gray: #333;
        }
        body {
            font-family: sans-serif;
            background: var(--dark);
            color: var(--light);
            margin: 0;
            display: flex;
            height: 100vh;
        }

        /* LOGIN SCREEN */
        #login-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .login-box {
            background: #222;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--primary);
        }
        .login-box input {
            padding: 10px;
            width: 200px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: none;
        }
        .login-box button {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* SIDEBAR */
        .sidebar {
            width: 250px;
            background: #1f1f1f;
            padding: 20px;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .sidebar h2 { color: var(--primary); margin-bottom: 20px; }
        .nav-btn {
            background: transparent;
            color: #aaa;
            border: none;
            padding: 15px;
            text-align: left;
            cursor: pointer;
            font-size: 16px;
            border-radius: 5px;
            transition: 0.3s;
        }
        .nav-btn:hover, .nav-btn.active {
            background: var(--primary);
            color: white;
        }

        /* MAIN CONTENT */
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .section { display: none; }
        .section.active { display: block; }

        /* FORM STYLES */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #ccc; }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #444;
            color: white;
            border-radius: 5px;
        }
        textarea { height: 100px; resize: vertical; }

        /* DYNAMIC LINKS */
        .link-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .remove-btn {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 0 15px;
            cursor: pointer;
            border-radius: 5px;
        }

        /* TABLE STYLES */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #333; text-align: left; }
        th { background: #222; color: var(--primary); }
        tr:hover { background: #1a1a1a; }
        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
        }
        .edit-btn { background: #FFA500; color: black; }
        .del-btn { background: #ff4444; color: white; }

        /* ACTION BAR */
        .action-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:var(--primary)">ADMIN PANEL</h2>
            <input type="password" id="adminPass" placeholder="Enter Password">
            <br>
            <button onclick="checkLogin()">Login</button>
            <p id="loginError" style="color:red; display:none; margin-top:10px;">Wrong Password!</p>
        </div>
    </div>

    <div id="dashboard" style="display: none; width: 100%; height: 100%;">
        
        <div class="sidebar">
            <h2><i class="fas fa-user-shield"></i> HDHub Admin</h2>
            <button class="nav-btn active" onclick="showSection('add-movie')"><i class="fas fa-plus-circle"></i> Add / Edit Movie</button>
            <button class="nav-btn" onclick="showSection('manage-movies'); loadMoviesList()"><i class="fas fa-list"></i> Manage Movies</button>
            <button class="nav-btn" onclick="logout()" style="margin-top:auto; background:#333;"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div class="main">
            
            <div id="add-movie" class="section active">
                <div class="action-bar">
                    <h2 id="formTitle">Add New Movie</h2>
                    <button class="btn-primary" onclick="resetForm()">Clear Form</button>
                </div>

                <div style="background:#1f1f1f; padding:20px; border-radius:10px;">
                    <div class="form-group">
                        <label>Movie Title (Auto ID generated from this)</label>
                        <input type="text" id="title" placeholder="e.g. Animal (2023)" onkeyup="updateIdPreview()">
                        <small style="color:#777;">Generated ID: <span id="idPreview" style="color:var(--primary)">...</span></small>
                    </div>

                    <div class="form-group">
                        <label>Poster Image URL</label>
                        <input type="text" id="poster" placeholder="https://...">
                        <img id="posterPreview" src="" style="height:100px; margin-top:10px; display:none;">
                    </div>

                    <div style="display:flex; gap:20px;">
                        <div class="form-group" style="flex:1">
                            <label>Quality</label>
                            <input type="text" id="quality" placeholder="1080p, 4K, HD">
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>Language</label>
                            <input type="text" id="language" placeholder="Hindi, Dual Audio">
                        </div>
                    </div>

                    <div style="display:flex; gap:20px;">
                         <div class="form-group" style="flex:1">
                            <label>Rating</label>
                            <input type="text" id="rating" placeholder="8.5">
                        </div>
                        <div class="form-group" style="flex:1">
                            <label>Category</label>
                            <input type="text" id="category" placeholder="Bollywood, Action">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Plot / Storyline</label>
                        <textarea id="plot" placeholder="Movie description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>Download Links <button onclick="addLinkField()" style="background:#333; color:white; border:none; border-radius:3px; cursor:pointer;">+ Add More</button></label>
                        <div id="links-container">
                            </div>
                    </div>

                    <button class="btn-primary" style="width:100%; font-size:18px;" onclick="uploadMovie()">ðŸš€ Upload / Update Movie</button>
                </div>
            </div>

            <div id="manage-movies" class="section">
                <div class="action-bar">
                    <h2>Manage Movies</h2>
                    <input type="text" id="searchAdmin" placeholder="Search..." onkeyup="filterAdminList()" style="width:300px;">
                </div>
                
                <table id="moviesTable">
                    <thead>
                        <tr>
                            <th>Poster</th>
                            <th>Title</th>
                            <th>ID</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, set, get, remove, child } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        // ðŸ”¥ FIREBASE CONFIGURATION (Apna Config Yahan Daalein)
        const firebaseConfig = {
             databaseURL: "https://education-921c2-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- GLOBAL FUNCTIONS EXPOSE ---
        window.db = db;
        window.ref = ref;
        window.set = set;
        window.get = get;
        window.remove = remove;
        window.child = child;
    </script>

    <script>
        // --- 2. AUTHENTICATION (Simple) ---
        function checkLogin() {
            const pass = document.getElementById('adminPass').value;
            // Yahan apna password set karein (Simple protection)
            if(pass === "admin123") { 
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
                // First link field add karo
                if(document.getElementById('links-container').children.length === 0) addLinkField();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            location.reload();
        }

        // --- 3. UI TABS ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(id).classList.add('active');
            
            // Highlight button logic
            if(id === 'add-movie') document.querySelector('button[onclick*="add-movie"]').classList.add('active');
            if(id === 'manage-movies') document.querySelector('button[onclick*="manage-movies"]').classList.add('active');
        }

        // --- 4. HELPER: CREATE ID (SAME AS SCRAPER) ---
        function createIdFromTitle(title) {
            return title
                .toLowerCase()
                .replace(/[^a-z0-9 ]/g, '') // Special chars hatao
                .trim()
                .replace(/\s+/g, '_');      // Space -> Underscore
        }

        function updateIdPreview() {
            const title = document.getElementById('title').value;
            document.getElementById('idPreview').innerText = createIdFromTitle(title);
        }

        // --- 5. DYNAMIC LINKS ---
        function addLinkField(name = "", url = "") {
            const container = document.getElementById('links-container');
            const div = document.createElement('div');
            div.className = 'link-row';
            div.innerHTML = `
                <input type="text" placeholder="Link Name (e.g. 720p)" class="link-name" value="${name}" style="flex:1">
                <input type="text" placeholder="Download URL" class="link-url" value="${url}" style="flex:2">
                <button class="remove-btn" onclick="this.parentElement.remove()">X</button>
            `;
            container.appendChild(div);
        }

        // --- 6. UPLOAD MOVIE ---
        function uploadMovie() {
            const title = document.getElementById('title').value;
            if(!title) return alert("Title is required!");

            const movieId = createIdFromTitle(title);
            
            // Collect Links
            const linkRows = document.querySelectorAll('.link-row');
            let linksArray = [];
            linkRows.forEach(row => {
                const name = row.querySelector('.link-name').value;
                const url = row.querySelector('.link-url').value;
                if(name && url) linksArray.push({name, url});
            });

            const movieData = {
                id: movieId,
                title: title,
                poster: document.getElementById('poster').value,
                quality: document.getElementById('quality').value || "HD",
                language: document.getElementById('language').value || "Hindi",
                rating: document.getElementById('rating').value,
                category: document.getElementById('category').value,
                plot: document.getElementById('plot').value,
                links: linksArray,
                updatedAt: Date.now() // Timestamp
            };

            // Firebase Save
            window.set(window.ref(window.db, 'movies/' + movieId), movieData)
            .then(() => {
                alert("âœ… Movie Saved Successfully!");
                resetForm();
            })
            .catch(err => alert("Error: " + err.message));
        }

        // --- 7. LOAD MOVIES LIST ---
        function loadMoviesList() {
            const tbody = document.querySelector('#moviesTable tbody');
            tbody.innerHTML = "<tr><td colspan='4'>Loading...</td></tr>";

            window.get(window.child(window.ref(window.db), 'movies')).then((snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    tbody.innerHTML = ""; // Clear loader
                    
                    // Sort by newest
                    const movies = Object.values(data).reverse();
                    window.allAdminMovies = movies; // For Search

                    renderTable(movies);
                } else {
                    tbody.innerHTML = "<tr><td colspan='4'>No movies found.</td></tr>";
                }
            });
        }

        function renderTable(movies) {
            const tbody = document.querySelector('#moviesTable tbody');
            tbody.innerHTML = "";
            
            movies.forEach(movie => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${movie.poster}" width="40"></td>
                    <td>${movie.title}</td>
                    <td style="color:#777; font-size:12px;">${movie.id}</td>
                    <td>
                        <button class="action-btn edit-btn" onclick="editMovie('${movie.id}')"><i class="fas fa-edit"></i></button>
                        <button class="action-btn del-btn" onclick="deleteMovie('${movie.id}')"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- 8. DELETE MOVIE ---
        window.deleteMovie = function(id) {
            if(confirm("Are you sure you want to delete this movie?")) {
                window.remove(window.ref(window.db, 'movies/' + id))
                .then(() => {
                    alert("Deleted!");
                    loadMoviesList(); // Refresh list
                });
            }
        }

        // --- 9. EDIT MOVIE (Populate Form) ---
        window.editMovie = function(id) {
            // Find movie data
            const movie = window.allAdminMovies.find(m => m.id === id);
            if(!movie) return;

            // Switch Tab
            showSection('add-movie');
            document.getElementById('formTitle').innerText = "Edit Movie: " + movie.title;

            // Fill Data
            document.getElementById('title').value = movie.title;
            document.getElementById('poster').value = movie.poster;
            document.getElementById('quality').value = movie.quality || "";
            document.getElementById('language').value = movie.language || "";
            document.getElementById('rating').value = movie.rating || "";
            document.getElementById('category').value = movie.category || "";
            document.getElementById('plot').value = movie.plot || "";
            updateIdPreview();

            // Fill Links
            document.getElementById('links-container').innerHTML = ""; // Clear old
            if(movie.links) {
                movie.links.forEach(link => addLinkField(link.name, link.url));
            } else {
                addLinkField(); // Add one empty
            }
        }

        function resetForm() {
            document.getElementById('formTitle').innerText = "Add New Movie";
            document.querySelectorAll('input').forEach(i => i.value = "");
            document.querySelectorAll('textarea').forEach(i => i.value = "");
            document.getElementById('links-container').innerHTML = "";
            addLinkField();
            updateIdPreview();
        }

        // --- 10. SEARCH IN ADMIN ---
        function filterAdminList() {
            const query = document.getElementById('searchAdmin').value.toLowerCase();
            const filtered = window.allAdminMovies.filter(m => m.title.toLowerCase().includes(query));
            renderTable(filtered);
        }

    </script>
</body>
</html>
